---
// Header component - relative initially, fixed on scroll up
import { CartButton } from './cart/CartButton';
---

<header id="navbar" class="relative w-full z-50 transition-all duration-300 bg-white">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-20">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2">
        <span class="text-2xl font-bold transition-colors duration-300" id="logo-text">
          <span class="text-olive">M</span>&<span class="text-accent-red">M</span><span class="text-charcoal"> Factory Pizza</span>
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-6">
        <a href="#menu" class="nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium">
          Menu
        </a>
        <a href="#about" class="nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium">
          About
        </a>
        <a href="#location" class="nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium">
          Location
        </a>
        <a href="#contact" class="nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium">
          Contact
        </a>
        
        <!-- Divider -->
        <div class="w-px h-6 bg-gray-200"></div>
        
        <!-- Cart Button -->
        <CartButton client:load />
        
        <a href="tel:+34871531423" class="ml-2 px-5 py-2.5 bg-royal-blue text-white font-semibold rounded-full hover:bg-royal-blue-dark transition-all duration-300 flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          Call Now
        </a>
      </div>

      <!-- Mobile Menu Button & Cart -->
      <div class="md:hidden flex items-center gap-2">
        <CartButton client:load />
        <button 
          id="mobile-menu-btn" 
          class="p-2 rounded-lg text-charcoal hover:bg-charcoal/10 transition-colors"
          aria-label="Toggle menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path id="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="md:hidden hidden pb-4">
      <div class="flex flex-col space-y-3">
        <a href="#menu" class="mobile-nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium py-2">
          Menu
        </a>
        <a href="#about" class="mobile-nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium py-2">
          About
        </a>
        <a href="#location" class="mobile-nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium py-2">
          Location
        </a>
        <a href="#contact" class="mobile-nav-link text-charcoal/80 hover:text-accent-red transition-colors duration-200 font-medium py-2">
          Contact
        </a>
        <a href="tel:+34871531423" class="mobile-nav-link inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-accent-red text-white font-semibold rounded-full hover:bg-accent-red-dark transition-all duration-300 mt-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
          Call Now
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  // Navbar scroll behavior - relative initially, fixed on scroll up
  const navbar = document.getElementById('navbar');
  const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
  
  let lastScrollY = window.scrollY;
  let ticking = false;
  let isFixed = false;
  const scrollThreshold = 100; // How far to scroll before behavior kicks in
  
  function updateNavbar() {
    const currentScrollY = window.scrollY;
    
    // Only start tracking after scrolling past threshold
    if (currentScrollY > scrollThreshold) {
      if (currentScrollY < lastScrollY) {
        // Scrolling UP - make navbar fixed and visible
        if (!isFixed) {
          navbar?.classList.remove('relative');
          navbar?.classList.add('fixed', 'top-0', 'left-0', 'right-0', 'shadow-lg');
          navbar?.classList.remove('-translate-y-full');
          navbar?.classList.add('translate-y-0');
          isFixed = true;
        }
      } else {
        // Scrolling DOWN - hide the fixed navbar
        if (isFixed) {
          navbar?.classList.add('-translate-y-full');
          navbar?.classList.remove('translate-y-0');
        }
      }
    } else {
      // At top of page - reset to relative
      if (isFixed) {
        navbar?.classList.remove('fixed', 'top-0', 'left-0', 'right-0', 'shadow-lg', '-translate-y-full', 'translate-y-0');
        navbar?.classList.add('relative');
        isFixed = false;
      }
    }
    
    lastScrollY = currentScrollY;
    ticking = false;
  }
  
  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        updateNavbar();
      });
      ticking = true;
    }
  });

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  
  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });

  // Close mobile menu when clicking a link
  mobileNavLinks.forEach(link => {
    link.addEventListener('click', () => {
      mobileMenu?.classList.add('hidden');
    });
  });
</script>
